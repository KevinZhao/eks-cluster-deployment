---
apiVersion: v1
kind: PersistentVolume
metadata:
  name: s3-pv-test
spec:
  accessModes:
  - ReadWriteMany
  capacity:
    storage: 10Gi
  storageClassName: ""
  csi:
    driver: s3.csi.aws.com
    volumeAttributes:
      bucketName: REPLACE_WITH_YOUR_BUCKET_NAME
    volumeHandle: s3-csi-driver-volume-test
  mountOptions:
  - region us-west-2
  - allow-other
  persistentVolumeReclaimPolicy: Retain
  volumeMode: Filesystem
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: s3-pvc-test
  namespace: default
spec:
  accessModes:
    - ReadWriteMany
  storageClassName: ""
  resources:
    requests:
      storage: 10Gi
  volumeName: s3-pv-test
---
apiVersion: v1
kind: Pod
metadata:
  name: s3-test-pod
  namespace: default
spec:
  containers:
  - name: test-container
    image: amazonlinux:2023
    command: ["/bin/sh"]
    args: ["-c", "echo 'Hello from EKS S3 CSI Driver!' > /mnt/s3/test-file.txt && cat /mnt/s3/test-file.txt && sleep 3600"]
    volumeMounts:
    - name: s3-volume
      mountPath: /mnt/s3
    resources:
      requests:
        memory: "64Mi"
        cpu: "250m"
      limits:
        memory: "128Mi"
        cpu: "500m"
  volumes:
  - name: s3-volume
    persistentVolumeClaim:
      claimName: s3-pvc-test
  restartPolicy: Never
